#!/usr/bin/env nu

# Script to preview what GitHub release assets will be generated
# Usage: nu scripts/preview-release-assets.nu [version]

def main [version?: string] {
    let release_version = if ($version | is-empty) {
        let cargo_content = open Cargo.toml --raw | decode utf-8
        let current_version_line = $cargo_content | lines | where ($it | str starts-with "version = ") | first
        $current_version_line | str replace 'version = "' '' | str replace '"' ''
    } else {
        $version
    }

    print $"ğŸ¯ Release Asset Preview for version ($release_version)"
    print "=" * 60
    print ""

    print "ğŸ“¦ Source Code (Auto-generated by GitHub):"
    print $"   â€¢ Source code \(zip\)"
    print $"   â€¢ Source code \(tar.gz\)"
    print ""

    print "ğŸ§ Linux Assets:"
    print $"   â€¢ fcos-ignition-coder-($release_version)-linux-x86_64.tar.gz"
    print $"   â€¢ fcos-ignition-coder-($release_version)-linux-x86_64.tar.gz.sha256"
    print $"     â””â”€ System-ready tarball with /usr/local structure"
    print $"     â””â”€ Includes binary, man page, and documentation"
    print ""

    print "ğŸ macOS Assets:"
    print $"   â€¢ fcos-ignition-coder-macos-x86_64.tar.gz"
    print $"   â€¢ fcos-ignition-coder-macos-x86_64.tar.gz.sha256"
    print $"     â””â”€ Intel Mac binary package"
    print $"   â€¢ fcos-ignition-coder-macos-aarch64.tar.gz"
    print $"   â€¢ fcos-ignition-coder-macos-aarch64.tar.gz.sha256"
    print $"     â””â”€ Apple Silicon Mac binary package"
    print ""

    print "ğŸªŸ Windows Assets:"
    print $"   â€¢ fcos-ignition-coder-windows-x86_64.zip"
    print $"   â€¢ fcos-ignition-coder-windows-x86_64.zip.sha256"
    print $"     â””â”€ Portable Windows binary package"
    print $"   â€¢ fcos-ignition-coder-($release_version)-x64.msi"
    print $"   â€¢ fcos-ignition-coder-($release_version)-x64.msi.sha256"
    print $"     â””â”€ Professional Windows installer with PATH integration"
    print ""

    print "ğŸ Conda Package:"
    print $"   â€¢ fcos-ignition-coder-($release_version)-*.tar.bz2"
    print $"   â€¢ fcos-ignition-coder-($release_version)-*.tar.bz2.sha256"
    print $"     â””â”€ Cross-platform conda package"
    print ""

    print "ğŸ“Š Summary:"
    print $"   Total assets: 12 files"
    print $"   Platforms: Linux, macOS \(2 architectures\), Windows"
    print $"   Package formats: Tarball, ZIP, MSI, Conda"
    print $"   Security: SHA256 checksums for all binary assets"
    print ""

    print "ğŸš€ To create this release:"
    print $"   pixi run release ($release_version)"
    print "   or"
    print $"   git tag v($release_version) && git push origin v($release_version)"
    print ""

    print "ğŸ“‹ Installation examples for users:"
    print ""
    print "Windows (MSI):"
    print $"   Download and run: fcos-ignition-coder-($release_version)-x64.msi"
    print ""
    print "Linux (System install):"
    print $"   sudo tar -xzf fcos-ignition-coder-($release_version)-linux-x86_64.tar.gz -C /"
    print ""
    print "macOS:"
    print $"   tar -xzf fcos-ignition-coder-macos-*.tar.gz"
    print $"   sudo cp bin/fcos-ignition-coder /usr/local/bin/"
    print ""
    print "Conda (future):"
    print $"   conda install -c conda-forge fcos-ignition-coder"
}
