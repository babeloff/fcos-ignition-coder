= Release Guide for fcos-ignition-coder
:toc:
:toclevels: 2

== Overview

This document describes how to create GitHub releases for the `fcos-ignition-coder` project. The project is a Rust-based CLI tool for encoding and decoding Fedora CoreOS Ignition configuration files.

== Prerequisites

Before setting up automated releases, ensure you have:

* Admin access to the GitHub repository
* The repository is public or you have GitHub Actions enabled
* Latest version of the code is on the `main` branch

== Setting Up GitHub Releases

=== 1. Create GitHub Actions Workflow

Create the following directory structure and workflow file:

```
.github/
└── workflows/
    └── release.yml
```

This workflow will:

* Trigger on version tags (e.g., `v0.1.0`, `v1.2.3`)
* Build the project for multiple targets
* Run tests
* Create a GitHub release with binaries
* Upload artifacts

=== 2. Version Management

The project version is managed in two places:

* `Cargo.toml` - Line 3: `version = "0.1.0"`
* `pixi.toml` - Line 6: `version = "0.1.0"`

Both files must be kept in sync for consistent versioning.

== Release Process

=== Manual Release Steps

. **Update Version Numbers**
+
```bash
# Update version in Cargo.toml
sed -i 's/version = "0\.1\.0"/version = "0.2.0"/' Cargo.toml

# Update version in pixi.toml
sed -i 's/version = "0\.1\.0"/version = "0.2.0"/' pixi.toml
```

. **Update Cargo.lock**
+
```bash
cargo update
```

. **Commit Version Changes**
+
```bash
git add Cargo.toml Cargo.lock pixi.toml
git commit -m "Bump version to 0.2.0"
git push origin main
```

. **Create and Push Tag**
+
```bash
git tag v0.2.0
git push origin v0.2.0
```

. **GitHub Actions will automatically:**
   * Build binaries for Linux, macOS, and Windows
   * Run the test suite
   * Create a GitHub release
   * Upload compiled binaries as release assets

=== Automated Release Workflow

Once the GitHub Actions workflow is set up, releases are triggered by pushing version tags:

```bash
# For patch releases (0.1.0 -> 0.1.1)
git tag v0.1.1 && git push origin v0.1.1

# For minor releases (0.1.0 -> 0.2.0)
git tag v0.2.0 && git push origin v0.2.0

# For major releases (0.1.0 -> 1.0.0)
git tag v1.0.0 && git push origin v1.0.0
```

== Build Targets

The release workflow should build for these targets:

* `x86_64-unknown-linux-gnu` - Linux 64-bit
* `x86_64-apple-darwin` - macOS 64-bit (Intel)
* `aarch64-apple-darwin` - macOS 64-bit (Apple Silicon)
* `x86_64-pc-windows-msvc` - Windows 64-bit

== Release Artifacts

Each release will include:

* **Source code** - Automatically generated by GitHub
* **Linux binary** - `fcos-ignition-coder-linux-x86_64`
* **macOS Intel binary** - `fcos-ignition-coder-macos-x86_64`
* **macOS ARM binary** - `fcos-ignition-coder-macos-aarch64`
* **Windows binary** - `fcos-ignition-coder-windows-x86_64.exe`
* **Checksums** - SHA256 sums for all binaries

== Release Notes Template

When creating releases, use this template for release notes:

```
## What's Changed

### New Features
* Feature description

### Bug Fixes
* Bug fix description

### Other Changes
* Other changes

## Installation

### Download Binary
Download the appropriate binary for your platform from the assets below.

### Using Cargo
```bash
cargo install fcos-ignition-coder --version 0.2.0
```

### Using pixi
```bash
git clone https://github.com/USERNAME/fcos-ignition-coder
cd fcos-ignition-coder
pixi install
pixi run build
```
```

== Troubleshooting

=== Common Issues

**Workflow fails to build**::
* Check that all dependencies are properly specified in `Cargo.toml`
* Ensure the code compiles locally with `cargo build --release`
* Verify tests pass with `cargo test`

**Version mismatch errors**::
* Ensure `Cargo.toml` and `pixi.toml` versions are synchronized
* Run `cargo update` after version changes

**Permission errors**::
* Verify the GitHub token has necessary permissions
* Check repository settings for Actions permissions

=== Testing the Release Process

Before creating official releases, test the workflow:

. Push a test tag: `git tag v0.1.0-test && git push origin v0.1.0-test`
. Monitor the Actions tab in GitHub
. Verify artifacts are generated correctly
. Delete test release and tag when satisfied

== Security Considerations

* Never hardcode API keys or secrets in workflow files
* Use GitHub's encrypted secrets for sensitive data
* Verify artifact checksums before distribution
* Consider signing releases for additional security

== Next Steps

After setting up releases:

. Create the GitHub Actions workflow file
. Test with a pre-release tag
. Update project documentation to reference releases
. Consider automating version bumping with tools like `cargo-release`
. Set up release notifications or changelogs
