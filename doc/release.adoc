= Release Guide for fcos-ignition-coder
:toc:
:toclevels: 2

== Overview

This document describes how to create GitHub releases for the `fcos-ignition-coder` project,
a Rust-based CLI tool for encoding and decoding Fedora CoreOS Ignition configuration files.

The release system automatically builds and distributes multiple package formats
including MSI installers, system-ready tarballs, and conda packages across Linux, macOS, and Windows platforms.

== Prerequisites

Before creating releases, ensure you have:

* Admin access to the GitHub repository
* GitHub Actions enabled on the repository
* Latest version of the code is on the `main` branch
* WiX installer assets generated (run `pixi run generate-wix-assets`)

== Release Process

=== Automated Release (Recommended)

The simplest way to create a release:

[source,bash]
----
# Check release readiness
pixi run release-dry-run

# Create complete release with all package formats
pixi run release 0.2.0
----

This will:
. Update version numbers in `Cargo.toml` and `pixi.toml`
. Run tests and build verification
. Commit changes and create git tag
. Push tag to trigger GitHub Actions workflow
. Generate all 12 release assets automatically

=== Manual Release Steps

For more control over the process:

. **Update Version Numbers**
+
[source,bash]
----
# Interactive version bump with confirmation
pixi run bump-version 0.2.0
----

. **Create and Push Tag**
+
[source,bash]
----
# Push the version commit
git push origin main

# Create and push release tag
git tag v0.2.0
git push origin v0.2.0
----

. **GitHub Actions Automatically:**
   * Builds binaries for all platforms
   * Runs the complete test suite
   * Creates GitHub release with assets
   * Generates MSI installer
   * Builds conda package

== GitHub Release Assets

Each release automatically generates **12 assets**:

=== Source Code (2 assets - GitHub auto-generated)
* `Source code (zip)`
* `Source code (tar.gz)`

=== Linux (2 assets)
* `fcos-ignition-coder-<version>-linux-x86_64.tar.gz`
  - System-ready installation with `/usr/local/` structure
  - Includes binary, man page, and documentation
* `fcos-ignition-coder-<version>-linux-x86_64.tar.gz.sha256`

=== macOS (4 assets)
* `fcos-ignition-coder-macos-x86_64.tar.gz` (Intel)
* `fcos-ignition-coder-macos-x86_64.tar.gz.sha256`
* `fcos-ignition-coder-macos-aarch64.tar.gz` (Apple Silicon)
* `fcos-ignition-coder-macos-aarch64.tar.gz.sha256`

=== Windows (4 assets)
* `fcos-ignition-coder-windows-x86_64.zip` (Portable)
* `fcos-ignition-coder-windows-x86_64.zip.sha256`
* `fcos-ignition-coder-<version>-x64.msi` (Installer with PATH integration)
* `fcos-ignition-coder-<version>-x64.msi.sha256`

=== Conda Package (2 assets)
* `fcos-ignition-coder-<version>-*.tar.bz2` (Cross-platform package)
* `fcos-ignition-coder-<version>-*.tar.bz2.sha256`

=== Asset Verification

Verify downloads using SHA256 checksums:

[source,bash]
----
# Linux/macOS
sha256sum -c fcos-ignition-coder-<version>-linux-x86_64.tar.gz.sha256
----

[source,powershell]
----
# Windows PowerShell
$expected = Get-Content fcos-ignition-coder-VERSION-x64.msi.sha256
$actual = (Get-FileHash fcos-ignition-coder-VERSION-x64.msi -Algorithm SHA256).Hash
if ($expected -eq $actual) { "✅ Verified" } else { "❌ Mismatch" }
----

== Installation Instructions for Users

=== Windows
**MSI Installer (Recommended):**
1. Download `fcos-ignition-coder-<version>-x64.msi`
2. Run installer (adds to PATH automatically)
3. Verify: `fcos-ignition-coder --help`

**Portable ZIP:**
1. Download and extract `fcos-ignition-coder-windows-x86_64.zip`
2. Manually add to PATH if desired

=== Linux
**System Installation:**
[source,bash]
----
# Download and install system-wide
wget https://github.com/USER/fcos-ignition-coder/releases/download/v<version>/fcos-ignition-coder-<version>-linux-x86_64.tar.gz
sudo tar -xzf fcos-ignition-coder-<version>-linux-x86_64.tar.gz -C /

# Verify installation
fcos-ignition-coder --help
man fcos-ignition-coder
----

**Conda (Future):**
[source,bash]
----
conda install -c conda-forge fcos-ignition-coder
----

=== macOS
[source,bash]
----
# Download appropriate architecture
# Intel: fcos-ignition-coder-macos-x86_64.tar.gz
# Apple Silicon: fcos-ignition-coder-macos-aarch64.tar.gz

tar -xzf fcos-ignition-coder-macos-*.tar.gz
sudo cp bin/fcos-ignition-coder /usr/local/bin/
sudo cp -r share/* /usr/local/share/ 2>/dev/null || true
----

=== Cross-Platform
**Cargo:**
[source,bash]
----
cargo install fcos-ignition-coder --version <version>
----

**Development Build:**
[source,bash]
----
git clone https://github.com/USERNAME/fcos-ignition-coder
cd fcos-ignition-coder
pixi install
pixi run build
----

== Release Notes Template

Use this template when editing GitHub releases:

----
## What's Changed

### New Features
* Feature descriptions

### Bug Fixes
* Bug fix descriptions

### Other Changes
* Other notable changes

## Installation

See installation options above for Windows MSI, Linux tarball, macOS, conda, and cargo methods.

Full documentation: https://github.com/USERNAME/fcos-ignition-coder
----

== Package Format Details

=== Linux Tarball Structure
----
usr/local/
├── bin/fcos-ignition-coder
├── share/
│   ├── man/man1/fcos-ignition-coder.1
│   └── doc/fcos-ignition-coder/
│       ├── README.md
│       ├── LICENSE
│       └── release.adoc
----

=== MSI Installer Features
* Automatic PATH configuration
* Add/Remove Programs integration
* Uninstaller support
* Custom branding (icon, banner, dialog)
* Silent installation support (`/quiet`)

=== Conda Package Features
* Cross-platform compatibility
* Dependency management
* Environment isolation
* License and source metadata
* Update capability via package manager

== Troubleshooting

=== Common Issues

**Build Failures:**
* Verify `cargo build --release` and `cargo test` pass locally
* Check `Cargo.toml` dependencies are correct
* Ensure all platforms build in GitHub Actions

**Version Sync Issues:**
* Use `pixi run bump-version` to keep `Cargo.toml` and `pixi.toml` synchronized
* Run `cargo update` after version changes

**GitHub Actions Permissions:**
* Verify repository has Actions enabled
* Check token permissions in repository settings

=== Testing Releases

Test the workflow before official releases:

[source,bash]
----
# Create test release
git tag v0.1.0-test && git push origin v0.1.0-test

# Monitor GitHub Actions tab
# Verify all 12 assets are generated
# Delete test release when satisfied
----

== Security Considerations

* All assets include SHA256 checksums for verification
* Use GitHub encrypted secrets for sensitive data
* Consider code signing certificates for Windows MSI
* Test installations on clean systems
* Follow FHS standards for Linux tarball structure

== CI/CD Pipeline

The release workflow consists of three parallel jobs:

1. **`build-binaries`**: Platform-specific binaries and tarballs
2. **`build-msi`**: Windows MSI installer using WiX toolset
3. **`build-conda`**: Cross-platform conda package

All jobs upload artifacts to the same GitHub release.

== Production Enhancements

=== MSI Installer
* Replace WiX placeholder assets with branded images
* Add code signing certificate for Windows SmartScreen
* Test across Windows versions

=== Conda Distribution
* Submit recipe to conda-forge feedstock
* Set up automated package updates
* Configure proper metadata

=== Distribution
* Consider CDN for faster downloads
* Explore distribution-specific packages (DEB/RPM)
* Implement update notifications

== Available Tools

Preview and manage releases using pixi tasks:

[source,bash]
----
pixi run preview-assets          # Preview what assets will be generated
pixi run release-dry-run        # Check release readiness
pixi run bump-version <version>  # Interactive version management
pixi run release <version>       # Complete automated release
pixi run generate-wix-assets     # Create MSI installer placeholders
----

For complete asset details and installation examples, run `pixi run preview-assets`.
