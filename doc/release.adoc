= Release Guide for fcos-ignition-coder
:toc:
:toclevels: 2

== Overview

This document describes how to create GitHub releases for the `fcos-ignition-coder` project. The project is a Rust-based CLI tool for encoding and decoding Fedora CoreOS Ignition configuration files.

== Prerequisites

Before setting up automated releases, ensure you have:

* Admin access to the GitHub repository
* The repository is public or you have GitHub Actions enabled
* Latest version of the code is on the `main` branch

== Setting Up GitHub Releases

=== 1. Create GitHub Actions Workflow

Create the following directory structure and workflow file:

```
.github/
└── workflows/
    └── release.yml
```

This workflow will:

* Trigger on version tags (e.g., `v0.1.0`, `v1.2.3`)
* Build the project for multiple targets
* Run tests
* Create a GitHub release with binaries
* Upload artifacts

=== 2. Version Management

The project version is managed in two places:

* `Cargo.toml` - Line 3: `version = "0.1.0"`
* `pixi.toml` - Line 6: `version = "0.1.0"`

Both files must be kept in sync for consistent versioning.

== Release Process

=== Manual Release Steps

. **Update Version Numbers**
+
```bash
# Update version in Cargo.toml
sed -i 's/version = "0\.1\.0"/version = "0.2.0"/' Cargo.toml

# Update version in pixi.toml
sed -i 's/version = "0\.1\.0"/version = "0.2.0"/' pixi.toml
```

. **Update Cargo.lock**
+
```bash
cargo update
```

. **Commit Version Changes**
+
```bash
git add Cargo.toml Cargo.lock pixi.toml
git commit -m "Bump version to 0.2.0"
git push origin main
```

. **Create and Push Tag**
+
```bash
git tag v0.2.0
git push origin v0.2.0
```

. **GitHub Actions will automatically:**
   * Build binaries for Linux, macOS, and Windows
   * Run the test suite
   * Create a GitHub release
   * Upload compiled binaries as release assets

=== Automated Release Workflow

Once the GitHub Actions workflow is set up, releases are triggered by pushing version tags:

```bash
# For patch releases (0.1.0 -> 0.1.1)
git tag v0.1.1 && git push origin v0.1.1

# For minor releases (0.1.0 -> 0.2.0)
git tag v0.2.0 && git push origin v0.2.0

# For major releases (0.1.0 -> 1.0.0)
git tag v1.0.0 && git push origin v1.0.0
```

== Build Targets

The release workflow builds multiple package formats:

=== Binary Targets
* `x86_64-unknown-linux-gnu` - Linux 64-bit
* `x86_64-apple-darwin` - macOS 64-bit (Intel)
* `aarch64-apple-darwin` - macOS 64-bit (Apple Silicon)
* `x86_64-pc-windows-msvc` - Windows 64-bit

=== Package Formats
* **Linux Tarball** - System-ready installation with man pages and documentation
* **Windows MSI** - Professional installer using WiX toolset
* **Conda Package** - Cross-platform package manager compatibility
* **Portable Archives** - ZIP/TAR.GZ for manual installation

== Release Artifacts

Each release will include:

=== Source Code
* **Source code** - Automatically generated by GitHub (zip and tar.gz)

=== Binary Packages
* **Linux Tarball** - `fcos-ignition-coder-<version>-linux-x86_64.tar.gz`
  - Includes binary, documentation, man page, and proper directory structure
  - Ready for system-wide installation (`/usr/local/*`)
* **macOS Intel** - `fcos-ignition-coder-macos-x86_64.tar.gz`
* **macOS ARM** - `fcos-ignition-coder-macos-aarch64.tar.gz`
* **Windows ZIP** - `fcos-ignition-coder-windows-x86_64.zip`

=== Installer Packages
* **Windows MSI** - `fcos-ignition-coder-<version>-x64.msi`
  - Professional Windows installer with PATH integration
  - Includes uninstaller and Add/Remove Programs integration
  - Automated installation and system integration
* **Conda Package** - `fcos-ignition-coder-<version>-*.tar.bz2`
  - Compatible with conda/mamba package managers
  - Cross-platform package management
  - Dependency resolution and virtual environments

=== Security
* **SHA256 Checksums** - For all artifacts to verify integrity

== Release Notes Template

When creating releases, use this template for release notes:

```
## What's Changed

### New Features
* Feature description

### Bug Fixes
* Bug fix description

### Other Changes
* Other changes

## Installation Options

### Windows
**MSI Installer (Recommended)**
```powershell
# Download and run the MSI installer
# Automatically adds to PATH and creates uninstaller
fcos-ignition-coder-X.Y.Z-x64.msi
```

**Portable ZIP**
```powershell
# Extract ZIP and add to PATH manually
Expand-Archive fcos-ignition-coder-windows-x86_64.zip
```

### Linux
**System Installation from Tarball**
```bash
# Extract to system directories with proper structure
sudo tar -xzf fcos-ignition-coder-X.Y.Z-linux-x86_64.tar.gz -C /
# Includes binary, man page, and documentation
```

**Conda/Mamba**
```bash
# Install via conda (when published to conda-forge)
conda install -c conda-forge fcos-ignition-coder
# or
mamba install -c conda-forge fcos-ignition-coder
```

### macOS
**Tarball Installation**
```bash
tar -xzf fcos-ignition-coder-macos-[x86_64|aarch64].tar.gz
sudo cp bin/fcos-ignition-coder /usr/local/bin/
```

### Cross-Platform Options
**Cargo (Rust Package Manager)**
```bash
cargo install fcos-ignition-coder --version X.Y.Z
```

**Development Build with Pixi**
```bash
git clone https://github.com/USERNAME/fcos-ignition-coder
cd fcos-ignition-coder
pixi install
pixi run build
```
```

== Troubleshooting

=== Common Issues

**Workflow fails to build**::
* Check that all dependencies are properly specified in `Cargo.toml`
* Ensure the code compiles locally with `cargo build --release`
* Verify tests pass with `cargo test`

**Version mismatch errors**::
* Ensure `Cargo.toml` and `pixi.toml` versions are synchronized
* Run `cargo update` after version changes

**Permission errors**::
* Verify the GitHub token has necessary permissions
* Check repository settings for Actions permissions

=== Testing the Release Process

Before creating official releases, test the workflow:

. Push a test tag: `git tag v0.1.0-test && git push origin v0.1.0-test`
. Monitor the Actions tab in GitHub
. Verify artifacts are generated correctly
. Delete test release and tag when satisfied

== Security Considerations

* Never hardcode API keys or secrets in workflow files
* Use GitHub's encrypted secrets for sensitive data
* Verify artifact checksums before distribution
* Consider signing releases for additional security

=== Package-Specific Security

**MSI Installers:**
* Consider code signing certificates for Windows SmartScreen compatibility
* Test installer on clean Windows systems
* Validate WiX configuration for security best practices

**Conda Packages:**
* Source tarball checksums are automatically verified
* Built in isolated conda-build environment
* Package metadata includes license and source information

**Linux Tarballs:**
* Include proper file permissions and directory structure
* Verify installation paths follow FHS (Filesystem Hierarchy Standard)
* Test installation on different Linux distributions

== Next Steps

After setting up releases:

. Create the GitHub Actions workflow file
. Generate WiX installer assets: `pixi run generate-wix-assets`
. Test with a pre-release tag
. Update project documentation to reference releases
. Consider automating version bumping with tools like `cargo-release`
. Set up release notifications or changelogs

=== Production Considerations

**MSI Installer Enhancement:**
* Replace placeholder WiX assets with branded images
* Add code signing certificate for trusted installation
* Test installer across different Windows versions
* Consider custom installation dialogs

**Conda Package Publishing:**
* Submit package recipe to conda-forge feedstock
* Set up automated conda package updates
* Configure package metadata and dependencies

**Distribution Optimization:**
* Set up CDN for faster downloads
* Consider creating distribution-specific packages (DEB/RPM)
* Implement update notification mechanisms
