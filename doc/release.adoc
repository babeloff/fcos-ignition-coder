= Release Guide for fcos-ignition-coder
:toc:
:toclevels: 2

== Overview

This document describes how to create GitHub releases for the `fcos-ignition-coder` project. The project is a Rust-based CLI tool for encoding and decoding Fedora CoreOS Ignition configuration files.

== Prerequisites

Before setting up automated releases, ensure you have:

* Admin access to the GitHub repository
* The repository is public or you have GitHub Actions enabled
* Latest version of the code is on the `main` branch

== Setting Up GitHub Releases

=== 1. Create GitHub Actions Workflow

Create the following directory structure and workflow file:

```
.github/
└── workflows/
    └── release.yml
```

This workflow will:

* Trigger on version tags (e.g., `v0.1.0`, `v1.2.3`)
* Build the project for multiple targets
* Run tests
* Create a GitHub release with binaries
* Upload artifacts

=== 2. Version Management

The project version is managed in two places:

* `Cargo.toml` - Line 3: `version = "0.1.0"`
* `pixi.toml` - Line 6: `version = "0.1.0"`

Both files must be kept in sync for consistent versioning.

== Release Process

=== Manual Release Steps

. **Update Version Numbers**
+
```bash
# Update version in Cargo.toml
sed -i 's/version = "0\.1\.0"/version = "0.2.0"/' Cargo.toml

# Update version in pixi.toml
sed -i 's/version = "0\.1\.0"/version = "0.2.0"/' pixi.toml
```

. **Update Cargo.lock**
+
```bash
cargo update
```

. **Commit Version Changes**
+
```bash
git add Cargo.toml Cargo.lock pixi.toml
git commit -m "Bump version to 0.2.0"
git push origin main
```

. **Create and Push Tag**
+
```bash
git tag v0.2.0
git push origin v0.2.0
```

. **GitHub Actions will automatically:**
   * Build binaries for Linux, macOS, and Windows
   * Run the test suite
   * Create a GitHub release
   * Upload compiled binaries as release assets

=== Automated Release Workflow

Once the GitHub Actions workflow is set up, releases are triggered by pushing version tags:

```bash
# For patch releases (0.1.0 -> 0.1.1)
git tag v0.1.1 && git push origin v0.1.1

# For minor releases (0.1.0 -> 0.2.0)
git tag v0.2.0 && git push origin v0.2.0

# For major releases (0.1.0 -> 1.0.0)
git tag v1.0.0 && git push origin v1.0.0
```

== Build Targets

The release workflow builds multiple package formats:

=== Binary Targets
* `x86_64-unknown-linux-gnu` - Linux 64-bit
* `x86_64-apple-darwin` - macOS 64-bit (Intel)
* `aarch64-apple-darwin` - macOS 64-bit (Apple Silicon)
* `x86_64-pc-windows-msvc` - Windows 64-bit

=== Package Formats
* **Linux Tarball** - System-ready installation with man pages and documentation
* **Windows MSI** - Professional installer using WiX toolset
* **Conda Package** - Cross-platform package manager compatibility
* **Portable Archives** - ZIP/TAR.GZ for manual installation

== GitHub Release Assets

When the GitHub Actions workflow completes, the following **12 assets** will be automatically created and uploaded to the GitHub release:

=== Source Code (Auto-generated by GitHub)
* `Source code (zip)` - Automatically generated by GitHub
* `Source code (tar.gz)` - Automatically generated by GitHub

=== Linux Assets (2 files)
* `fcos-ignition-coder-<version>-linux-x86_64.tar.gz`
  - System-ready installation tarball
  - Includes binary in `/usr/local/bin/`
  - Includes man page in `/usr/local/share/man/man1/`
  - Includes documentation in `/usr/local/share/doc/fcos-ignition-coder/`
* `fcos-ignition-coder-<version>-linux-x86_64.tar.gz.sha256`
  - SHA256 checksum for verification

=== macOS Assets (4 files)
* `fcos-ignition-coder-macos-x86_64.tar.gz`
  - Intel Mac binary package with documentation
* `fcos-ignition-coder-macos-x86_64.tar.gz.sha256`
  - SHA256 checksum for verification
* `fcos-ignition-coder-macos-aarch64.tar.gz`
  - Apple Silicon Mac binary package with documentation
* `fcos-ignition-coder-macos-aarch64.tar.gz.sha256`
  - SHA256 checksum for verification

=== Windows Assets (4 files)
* `fcos-ignition-coder-windows-x86_64.zip`
  - Portable Windows binary package
  - Includes executable, README, and LICENSE
* `fcos-ignition-coder-windows-x86_64.zip.sha256`
  - SHA256 checksum for verification
* `fcos-ignition-coder-<version>-x64.msi`
  - Professional Windows installer using WiX toolset
  - Automatic PATH integration
  - Add/Remove Programs integration
  - Custom branding and installation dialogs
* `fcos-ignition-coder-<version>-x64.msi.sha256`
  - SHA256 checksum for verification

=== Conda Package (2 files)
* `fcos-ignition-coder-<version>-*.tar.bz2`
  - Cross-platform conda package
  - Compatible with conda/mamba package managers
  - Includes proper metadata and dependencies
* `fcos-ignition-coder-<version>-*.tar.bz2.sha256`
  - SHA256 checksum for verification

=== Asset Verification

All assets include SHA256 checksums for security verification:

==== Linux/macOS
[source,bash]
----
# Download both the package and its .sha256 file
sha256sum -c fcos-ignition-coder-<version>-linux-x86_64.tar.gz.sha256
----

==== Windows (PowerShell)
[source,powershell]
----
# Download both the package and its .sha256 file
$expectedHash = Get-Content fcos-ignition-coder-VERSION-x64.msi.sha256
$actualHash = (Get-FileHash fcos-ignition-coder-VERSION-x64.msi -Algorithm SHA256).Hash
if ($expectedHash -eq $actualHash) { "✅ Checksum verified" } else { "❌ Checksum mismatch" }
----

== Release Notes Template

When creating releases, use this template for release notes:

```
## What's Changed

### New Features
* Feature description

### Bug Fixes
* Bug fix description

### Other Changes
* Other changes

## Installation Options

=== Windows Users
**Option 1: MSI Installer (Recommended)**
1. Download `fcos-ignition-coder-<version>-x64.msi`
2. Double-click to install
3. The installer will automatically add the program to your PATH
4. Open Command Prompt or PowerShell and run: `fcos-ignition-coder --help`

**Option 2: Portable ZIP**
1. Download `fcos-ignition-coder-windows-x86_64.zip`
2. Extract to a folder of your choice
3. Manually add the folder to your PATH if desired

=== Linux Users
**System Installation (Recommended)**
[source,bash]
----
# Download the tarball
wget https://github.com/USER/fcos-ignition-coder/releases/download/v<version>/fcos-ignition-coder-<version>-linux-x86_64.tar.gz

# Extract with proper system structure
sudo tar -xzf fcos-ignition-coder-<version>-linux-x86_64.tar.gz -C /

# Verify installation
fcos-ignition-coder --help
man fcos-ignition-coder
----

**Conda Installation (Future)**
[source,bash]
----
# Once published to conda-forge
conda install -c conda-forge fcos-ignition-coder
# or
mamba install -c conda-forge fcos-ignition-coder
----

=== macOS Users
**Installation**
[source,bash]
----
# Download appropriate version (Intel or Apple Silicon)
# Intel Macs:
wget https://github.com/USER/fcos-ignition-coder/releases/download/v<version>/fcos-ignition-coder-macos-x86_64.tar.gz

# Apple Silicon Macs:
wget https://github.com/USER/fcos-ignition-coder/releases/download/v<version>/fcos-ignition-coder-macos-aarch64.tar.gz

# Extract and install
tar -xzf fcos-ignition-coder-macos-*.tar.gz
sudo cp bin/fcos-ignition-coder /usr/local/bin/
sudo cp -r share/* /usr/local/share/ 2>/dev/null || true

# Verify installation
fcos-ignition-coder --help
----

=== Cross-Platform Options
**Cargo (Rust Package Manager)**
[source,bash]
----
cargo install fcos-ignition-coder --version X.Y.Z
----

**Development Build with Pixi**
[source,bash]
----
git clone https://github.com/USERNAME/fcos-ignition-coder
cd fcos-ignition-coder
pixi install
pixi run build
----
```

== Troubleshooting

=== Common Issues

**Workflow fails to build**::
* Check that all dependencies are properly specified in `Cargo.toml`
* Ensure the code compiles locally with `cargo build --release`
* Verify tests pass with `cargo test`

**Version mismatch errors**::
* Ensure `Cargo.toml` and `pixi.toml` versions are synchronized
* Run `cargo update` after version changes

**Permission errors**::
* Verify the GitHub token has necessary permissions
* Check repository settings for Actions permissions

=== Testing the Release Process

Before creating official releases, test the workflow:

. Push a test tag: `git tag v0.1.0-test && git push origin v0.1.0-test`
. Monitor the Actions tab in GitHub
. Verify artifacts are generated correctly
. Delete test release and tag when satisfied

== Security Considerations

* Never hardcode API keys or secrets in workflow files
* Use GitHub's encrypted secrets for sensitive data
* Verify artifact checksums before distribution
* Consider signing releases for additional security

=== Package-Specific Security

**MSI Installers:**
* Consider code signing certificates for Windows SmartScreen compatibility
* Test installer on clean Windows systems
* Validate WiX configuration for security best practices

**Conda Packages:**
* Source tarball checksums are automatically verified
* Built in isolated conda-build environment
* Package metadata includes license and source information

**Linux Tarballs:**
* Include proper file permissions and directory structure
* Verify installation paths follow FHS (Filesystem Hierarchy Standard)
* Test installation on different Linux distributions

== Next Steps

After setting up releases:

. Create the GitHub Actions workflow file
. Generate WiX installer assets: `pixi run generate-wix-assets`
. Test with a pre-release tag
. Update project documentation to reference releases
. Consider automating version bumping with tools like `cargo-release`
. Set up release notifications or changelogs

== Package Format Details

=== Linux Tarball Structure
----
usr/
├── local/
│   ├── bin/
│   │   └── fcos-ignition-coder
│   ├── share/
│   │   ├── man/
│   │   │   └── man1/
│   │   │       └── fcos-ignition-coder.1
│   │   └── doc/
│   │       └── fcos-ignition-coder/
│   │           ├── README.md
│   │           ├── LICENSE
│   │           └── release.adoc
----

=== MSI Installer Features
* **Automatic PATH Configuration**: Adds installation directory to system PATH
* **Start Menu Integration**: Creates Start Menu entries
* **Uninstaller**: Includes proper uninstallation support
* **Registry Integration**: Registers with Add/Remove Programs
* **Custom Branding**: Uses project-specific icons and dialogs
* **Silent Installation**: Supports `/quiet` flag for automated deployments

=== Conda Package Metadata
* **Cross-platform**: Works on Linux, macOS, and Windows
* **Dependency Management**: Automatically handles Rust runtime dependencies
* **Environment Isolation**: Integrates with conda/mamba environments
* **License Information**: Includes proper license and source metadata
* **Automatic Updates**: Can be updated via conda package manager

== CI/CD Pipeline Overview

The release process involves three parallel build jobs:

1. **`build-binaries`**: Creates platform-specific binaries and packages
2. **`build-msi`**: Creates Windows MSI installer using WiX toolset
3. **`build-conda`**: Creates conda package for cross-platform distribution

All jobs upload their artifacts to the same GitHub release, providing users with multiple installation options.

=== Production Considerations

**MSI Installer Enhancement:**
* Replace placeholder WiX assets with branded images
* Add code signing certificate for trusted installation
* Test installer across different Windows versions
* Consider custom installation dialogs

**Conda Package Publishing:**
* Submit package recipe to conda-forge feedstock
* Set up automated conda package updates
* Configure package metadata and dependencies

**Distribution Optimization:**
* Set up CDN for faster downloads
* Consider creating distribution-specific packages (DEB/RPM)
* Implement update notification mechanisms
